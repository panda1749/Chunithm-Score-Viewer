(function(h,D){function E(a){function d(b){return 1===b?"FC ":2===b?"AJ ":"   "}var b=a.b.i,c=z(),f=k(null,"userFriendGenreVs_result"),m=k([e.F,e.o],null,k([e.G,e.U+p[b]],"DifficulityName",["BASIC","ADVANCED","EXPERT","MASTER"][b]));l(a.w,function(c,f){var q=k([e.I,e.Z],null,k(null,"GenreName",f.name));l(f.items,function(c,f){var m=k([e.Y,e.R+p[b]],"FriendVS");g(m,k([e.D,e.T],"vsMusicTitle",g(k(),f.name)));var h=f.m,h=A(n(" ",1),n(d(h.h)+u(h.f),0)," ",3);g(m,h);l(f.g,function(b,c){var f=A(n(a.l[b],
0),n(d(c.h)+u(c.f),0),(0<=c.a?"+":"")+u(c.a),0<=c.a?0:1);g(m,f)});g(q,m)});g(m,q)});g(c,g(f,m))}function F(a){var d={};switch(a.b.group){case 1:for(var b=0;b<a.l.length+1;b++)d[b]={name:b+" WIN",items:[]};l(a.c,function(b,a){d[a.B.C].items.push(a)})}l(d,function(b,d){0!==d.items.length&&a.w.push(d)});E(a)}function G(a){var d=a.b.max,b=a.b.min;l(a.c,function(c,f){l(f.g,function(a,c){(c.a>d||c.a<b)&&delete f.g[a]});0===Object.keys(f.g).length&&delete a.c[c]});F(a)}function H(a){var d={c:{},l:[],w:[],
b:a.b};l(a.j.musicNameMap,function(b,c){d.c[b]={name:c,$:a.j.genreMap[b],m:{f:0,h:0,s:0,A:0},g:{},B:{C:0,O:0,M:0,a:0}}});l(a.j.userMusicList,function(b,a){d.c[a.musicId].m={f:a.scoreMax,h:a.isAllJustice?2:a.isFullCombo?1:0,s:a.fullChain,A:a.scoreRank}});l(a.v,function(a,c){d.l[a]=B(c.userName);l(c.userMusicList,function(b,c){var f=d.c[c.musicId],e=f.B,g=f.g[a]={f:c.scoreMax,h:c.isAllJustice?2:c.isFullCombo?1:0,s:c.fullChain,A:c.scoreRank},f=f.m.f-g.f;g.a=f;e.a+=f;0<=f?e.C++:0>f?e.O++:e.M++})});G(d)}
function I(a,d){if(0!==a.length){null===d.i&&(d.i=2);var b={j:null,v:[],b:d},c={level:19900+parseInt(d.i,10),isStatus:!0};x("GetUserMusicApi",c,function(a){this.j=a},b);var f=[];a.forEach(function(a){c.friendCode=a;a=x("GetUserMusicApi",c,function(a){this.v.push(a)},b);f.push(a)},b);h.when.apply(this,f).done(function(){H(b)})}}function x(a,d,b,c){d=d||{};d=h.extend(!0,{},d);b=b||function(){};b=b.bind(c||this);d.userId=parseInt(getCookie().userId,10);return h.ajax({type:"post",url:REQUEST_URL+a,data:JSON.stringify(d),
dataType:"json",scriptCharset:"UTF-8",success:function(a){null!=a.userId&&window.setCookie("userId",a.userId);b(a)}})}function z(){var a=h("."+e.u).empty();return g(a,y("h2",null,"page_title","\u30d5\u30ec\u30f3\u30c9VS"),y("hr",[e.N,e.o]))}function g(a,d){var b=h(a);Array.prototype.slice.call(arguments,1).forEach(function(a){b.append(a)});return b}function A(a,d,b,c){var f=k(e.X);b=k({0:"vs_list_count_blue",1:"vs_list_count_red",2:null,3:null}[c],null,b);b=k(e.W,null,b);2===c&&(c={color:"#999"},
b.css(c),a&&a.css(c),d&&d.css(c));g(f,a,b,d);return f}function n(a,d){var b=k(e.V);0===d?g(b,k(e.S,"vsMyScore",a)):g(b,a);return b}function y(a,d,b,c){Array.isArray(d)&&(d=d.join(" "));return h(C("<",a,"/>")).attr("id",b).addClass(d).append(c)}function u(a){return String(a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}function C(a){return Array.prototype.slice.call(arguments,0).join("")}function B(a){return a.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u201d/g,
'"').replace(/\u2019/g,"'").replace(/\u2018/g,"`").replace(/\uffe5/g,"\\").replace(/\u3000/g," ").replace(/\u301c/g,"~")}var l=D.each,k=y.bind(this,"div"),e={u:"frame01_inside",N:"line_dot_black",D:"block_underline",Y:"w388",Z:"w400",o:"w420",F:"box01",G:"box01_title",H:"box02",I:"box05",P:"mb_20",L:"difficulty_btn_block",K:"difficulty_btn",V:"vs_list_infoblock",X:"vs_list_result_block",W:"vs_list_result",S:"play_musicdata_highscore",T:"text_b",J:"btn_",R:"musiclist_",U:"title_"},p=["basic","advanced",
"expart","master"];z();(function(){function a(a){var b=C('<input type="checkbox" name="',a.friendCode,'" />');a=B(a.friendName);b=g(k(),b,a);g(this,b)}function d(a){var b=h(a.target);p.forEach(function(a,c){var d=f+p[c],e=b.hasClass(d)||b.hasClass(d+"_on");l[c].toggleClass(d+"_on",e);l[c].toggleClass(d,!e);e&&(n=c)})}var b=k([e.H,e.o,e.P]);g(h("."+e.u),b);var c=h('<form onsubmit="return false" />'),f=e.J,l={},q=k(e.L),n=2;p.forEach(function(a,b){var c=k(f+p[b]).click(d);g(q,k(e.K,null,c));l[b]=c});
g(c,q);var r=11E5,t=-11E5,v=k(),w=h('<input type="text" size="7" maxlength="7" />').change(function(a){var b=h(a.target);a=b.attr("name");var b=b.val(),c=parseInt(b,10),d=!isNaN(c);if("maxScore"==a){if(!d||11E5<b)c=11E5;r=c}else if("minScore"==a){if(!d||-11E5>b)c=-11E5;t=c}}),u=w.clone(!0).attr("name","minScore"),w=w.clone(!0).attr("name","maxScore");g(v,"\u30b9\u30b3\u30a2\u5dee<br/>",u,"\uff5e",w);g(c,v);v=h('<input type="button" value="\u8aad\u8fbc" onclick="" data-sorttype="1" />').click(function(a){a=
parseInt(h(a.target).attr("data-sorttype"),10);var b=[];c.find(":checkbox").each(function(){this.checked&&b.push(this.name)});if(r<t){var d=r;r=t;t=d}I(b,{sort:a,max:r,min:t,i:n,group:1})});g(b,c,v);x("GetUserFriendlistApi",{state:3},function(b){b=b.userFriendlistList.filter(function(a){return!0===a.isFavorite});b=b.map(function(a){return a.friendCode});var c=[];b.forEach(function(b){var d={};d.friendCode=parseInt(b,10);b=x("GetUserFriendNameApi",d,a,this);c.push(b)},this);return h.when.apply(this,
c)},c)})()})($,$);
