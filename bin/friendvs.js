(function(){var t=function(b){return b.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u201d/g,'"').replace(/\u2019/g,"'").replace(/\u2018/g,"`").replace(/\uffe5/g,"\\").replace(/\u3000/g," ").replace(/\u301c/g,"~")},x=function(b){return Array.prototype.slice.call(arguments,0).join("")},r=function(b,a,d,c){Array.isArray(a)&&(a=a.join(" "));return $(x("<",b,"/>")).attr("id",d).addClass(a).append(c)},e=r.bind(this,"div"),f=function(b,a){var d=$(b);
Array.prototype.slice.call(arguments,1).forEach(function(a){d.append(a)});return d},k=["basic","advanced","expart","master"],u=function(){var b=$(".frame01_inside").empty();return f(b,r("h2",null,"page_title","\u30d5\u30ec\u30f3\u30c9VS"),r("hr",["line_dot_black","w420"]))},p=function(b,a,d,c){a=a||{};d=(d||function(){}).bind(c||this);a.userId=parseInt(getCookie().userId);$.ajax({type:"post",url:REQUEST_URL+b,data:JSON.stringify(a),dataType:"json",scriptCharset:"UTF-8",success:d})},z=function(b,a,
d){if(0!==a.length){null==d&&(d=2);var c={sort:b,friendLength:a.length,myData:{},friendsData:[],dif:d};p("GetUserMusicApi",{level:19900+parseInt(d),isStatus:!0},function(a){this.musicNameMap=a.musicNameMap;this.genreMap=a.genreMap;this.myData=f(a)},c);a.forEach(function(a){p("GetUserMusicApi",{level:19900+parseInt(d),isStatus:!0,friendCode:a},function(a){this.friendsData.push(f(a));this.friendLength==this.friendsData.length&&y(this)},c)},c);var f=function(a){var b=[];a.userMusicList.forEach(function(a){this[a.musicId]=
a},b);return{name:t(a.userName),music:b}}}},y=function(b){var a=function(a){return String(a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},d=function(a,b,d,c,q,m){var g=function(a,b){var d=e("vs_list_infoblock");0==b?f(d,e("play_musicdata_highscore","vsMyScore",a)):f(d,a);return d},h=e("vs_list_result_block");null!=a&&f(h,g(a,c));null!=b&&(a=e("vs_list_result",null,e({0:"vs_list_count_blue",1:"vs_list_count_red",2:""}[q],null,b)),f(h,a));null!=d&&f(h,g(d,m));return h},c=u(),g=e(null,"userFriendGenreVs_result"),
l=e(["box01","w420"],null,e(["box01_title","title_"+k[b.dif]],"DifficulityName",["BASIC","ADVANCED","EXPERT","MASTER"][b.dif]));f(c,f(g,l));for(var n=function(){return{fullChain:0,isAllJustice:!1,isFullCombo:!1,isSuccess:!1,level:null,musicId:null,playCount:null,scoreMax:0,scoreRank:0,updateDate:null}},c=[],g=0;g<=b.friendLength;g++)c[g]=[];for(var h in b.musicNameMap){var q=0,m=e(["w388","musiclist_"+k[b.dif]],"FriendVS");f(m,e(["block_underline","text_b"],"vsMusicTitle",f(e(),b.musicNameMap[h])));
g=b.myData.music[h];null==g&&(g=n());var v=g.scoreMax,g=d(" "," ",(g.isAllJustice?"AJ ":g.isFullCombo?"FC ":"   ")+a(v),1,2,0);f(m,g);b.friendsData.forEach(function(b){var c=b.music[h];null==c&&(c=n());var g=c.scoreMax,e=v-g;0<=e&&q++;b=d(b.name,(0<=e?"+":"")+a(e),(c.isAllJustice?"AJ ":c.isFullCombo?"FC ":"   ")+a(g),0,0<=e?0:1,0);f(m,b)});c[q].push(m)}for(h in c)if(0!=c[h].length){var w=e(["box05","w400"],null,e(null,"GenreName",h+" WIN"));c[h].forEach(function(a){f(w,a)});f(l,w)}};u();(function(){var b=
e(["box02","w420","mb_20"]);f($(".frame01_inside"),b);var a=$('<form onsubmit="return false" />'),d=[],c=e("difficulty_btn_block"),g=2,l;for(l in k){var n=e("btn_"+k[l]).click(function(a){a=$(a.target);for(var b in k){var c="btn_"+k[b],e=a.hasClass(c)||a.hasClass(c+"_on");d[b].toggleClass(c+"_on",e);d[b].toggleClass(c,!e);e&&(g=b)}});f(c,e("difficulty_btn",null,n));d[l]=n}f(a,c);c=$('<input type="button" value="\u8aad\u8fbc" onclick="" data-sorttype="1" />').click(function(b){b=$(b.target).attr("data-sorttype");
var c=[];a.find(":checkbox").each(function(){this.checked&&c.push(this.name)});z(b,c,g)});f(b,a,c);var h=function(a){f(this,'<div><input type="checkbox" name="'+a.friendCode+'" />'+t(a.friendName)+"</div>")};p("GetUserFriendlistApi",{state:3},function(a){a=a.userFriendlistList.filter(function(a,b,c){return!0===a.isFavorite});a=a.map(function(a){return a.friendCode});a.forEach(function(a){p("GetUserFriendNameApi",{friendCode:parseInt(a)},h,this)},this)},a)})()})();
