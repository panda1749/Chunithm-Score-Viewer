(function(h,D){function E(a){function d(a){return 1===a?"FC ":2===a?"AJ ":"   "}var c=a.b.i,b=z(),f=k(null,"userFriendGenreVs_result"),m=k([e.F,e.o],null,k([e.G,e.U+p[c]],"DifficulityName",["BASIC","ADVANCED","EXPERT","MASTER"][c]));l(a.w,function(b,f){var q=k([e.I,e.Z],null,k(null,"GenreName",f.name));l(f.items,function(b,f){var m=k([e.Y,e.R+p[c]],"FriendVS");g(m,k([e.D,e.T],"vsMusicTitle",g(k(),f.name)));var h=f.m,h=A(n(" ",1),n(d(h.h)+u(h.f),0)," ",3);g(m,h);l(f.g,function(c,b){var f=A(n(a.l[c],
0),n(d(b.h)+u(b.f),0),(0<=b.a?"+":"")+u(b.a),0<=b.a?0:1);g(m,f)});g(q,m)});g(m,q)});g(b,g(f,m));console.log(a)}function F(a){var d={};switch(a.b.group){case 1:for(var c=0;c<a.l.length+1;c++)d[c]={name:c+" WIN",items:[]};l(a.c,function(a,c){d[c.B.C].items.push(c)})}l(d,function(c,d){0!==d.items.length&&a.w.push(d)});E(a)}function G(a){var d=a.b.max,c=a.b.min;l(a.c,function(b,f){l(f.g,function(a,b){(b.a>d||b.a<c)&&delete f.g[a]});0===Object.keys(f.g).length&&delete a.c[b]});F(a)}function H(a){console.log(a);
var d={c:{},l:[],w:[],b:a.b};l(a.j.musicNameMap,function(c,b){d.c[c]={name:b,$:a.j.genreMap[c],m:{f:0,h:0,s:0,A:0},g:{},B:{C:0,O:0,M:0,a:0}}});l(a.j.userMusicList,function(a,b){d.c[b.musicId].m={f:b.scoreMax,h:b.isAllJustice?2:b.isFullCombo?1:0,s:b.fullChain,A:b.scoreRank}});l(a.v,function(a,b){d.l[a]=B(b.userName);l(b.userMusicList,function(c,b){var f=d.c[b.musicId],e=f.B,g=f.g[a]={f:b.scoreMax,h:b.isAllJustice?2:b.isFullCombo?1:0,s:b.fullChain,A:b.scoreRank},f=f.m.f-g.f;g.a=f;e.a+=f;0<=f?e.C++:
0>f?e.O++:e.M++})});G(d)}function I(a,d){console.log(arguments);if(0!==a.length){null===d.i&&(d.i=2);var c={j:null,v:[],b:d},b={level:19900+parseInt(d.i,10),isStatus:!0};x("GetUserMusicApi",b,function(a){this.j=a},c);var f=[];a.forEach(function(a){b.friendCode=a;a=x("GetUserMusicApi",b,function(a){this.v.push(a)},c);f.push(a)},c);h.when.apply(this,f).done(function(){H(c)})}}function x(a,d,c,b){d=d||{};d=h.extend(!0,{},d);c=c||function(){};c=c.bind(b||this);d.userId=parseInt(getCookie().userId,10);
return h.ajax({type:"post",url:REQUEST_URL+a,data:JSON.stringify(d),dataType:"json",scriptCharset:"UTF-8",success:function(b){console.log(a,d,b);null!=b.userId&&window.setCookie("userId",b.userId);c(b)}})}function z(){var a=h("."+e.u).empty();return g(a,y("h2",null,"page_title","\u30d5\u30ec\u30f3\u30c9VS"),y("hr",[e.N,e.o]))}function g(a,d){var c=h(a);Array.prototype.slice.call(arguments,1).forEach(function(a){c.append(a)});return c}function A(a,d,c,b){var f=k(e.X);c=k({0:"vs_list_count_blue",1:"vs_list_count_red",
2:null,3:null}[b],null,c);c=k(e.W,null,c);2===b&&(b={color:"#999"},c.css(b),a&&a.css(b),d&&d.css(b));g(f,a,c,d);return f}function n(a,d){var c=k(e.V);0===d?g(c,k(e.S,"vsMyScore",a)):g(c,a);return c}function y(a,d,c,b){Array.isArray(d)&&(d=d.join(" "));return h(C("<",a,"/>")).attr("id",c).addClass(d).append(b)}function u(a){return String(a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}function C(a){return Array.prototype.slice.call(arguments,0).join("")}function B(a){return a.replace(/[\uff01-\uff5e]/g,
function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u201d/g,'"').replace(/\u2019/g,"'").replace(/\u2018/g,"`").replace(/\uffe5/g,"\\").replace(/\u3000/g," ").replace(/\u301c/g,"~")}var l=D.each,k=y.bind(this,"div"),e={u:"frame01_inside",N:"line_dot_black",D:"block_underline",Y:"w388",Z:"w400",o:"w420",F:"box01",G:"box01_title",H:"box02",I:"box05",P:"mb_20",L:"difficulty_btn_block",K:"difficulty_btn",V:"vs_list_infoblock",X:"vs_list_result_block",W:"vs_list_result",S:"play_musicdata_highscore",
T:"text_b",J:"btn_",R:"musiclist_",U:"title_"},p=["basic","advanced","expart","master"];z();(function(){function a(a){var b=C('<input type="checkbox" name="',a.friendCode,'" />');a=B(a.friendName);b=g(k(),b,a);g(this,b)}function d(a){var b=h(a.target);p.forEach(function(a,c){var d=f+p[c],e=b.hasClass(d)||b.hasClass(d+"_on");l[c].toggleClass(d+"_on",e);l[c].toggleClass(d,!e);e&&(n=c)})}var c=k([e.H,e.o,e.P]);g(h("."+e.u),c);var b=h('<form onsubmit="return false" />'),f=e.J,l={},q=k(e.L),n=2;p.forEach(function(a,
b){var c=k(f+p[b]).click(d);g(q,k(e.K,null,c));l[b]=c});g(b,q);var r=11E5,t=-11E5,v=k(),w=h('<input type="text" size="7" maxlength="7" />').change(function(a){a=h(a.target);var b=a.attr("name"),c=a.val(),d=parseInt(c,10),e=!isNaN(d);if("maxScore"==b){if(!e||11E5<c)d=11E5;r=d}else if("minScore"==b){if(!e||-11E5>c)d=-11E5;t=d}console.log({target:a,name:b,value:c,check:e,setValue:d})}),u=w.clone(!0).attr("name","minScore"),w=w.clone(!0).attr("name","maxScore");g(v,"\u30b9\u30b3\u30a2\u5dee<br/>",u,"\uff5e",
w);g(b,v);v=h('<input type="button" value="\u8aad\u8fbc" onclick="" data-sorttype="1" />').click(function(a){a=parseInt(h(a.target).attr("data-sorttype"),10);var c=[];b.find(":checkbox").each(function(){this.checked&&c.push(this.name)});if(r<t){var d=r;r=t;t=d}I(c,{sort:a,max:r,min:t,i:n,group:1})});g(c,b,v);x("GetUserFriendlistApi",{state:3},function(b){b=b.userFriendlistList.filter(function(a){return!0===a.isFavorite});b=b.map(function(a){return a.friendCode});var c=[];b.forEach(function(b){var d=
{};d.friendCode=parseInt(b,10);b=x("GetUserFriendNameApi",d,a,this);c.push(b)},this);return h.when.apply(this,c)},b)})()})($,$);
